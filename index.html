<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Penny Lane</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="contenedor-principal">
    <h1>PENNY LANE</h1>
    <h2>Nuevo gasto</h2>
    <h3 class="subtitulo-seccion">Con tarjeta de crédito</h3>

    <form id="dataForm" class="formulario-ingreso">
      <div class="campo-grupo">
        <label for="autor">¿Quién?</label>
        <select name="autor" id="autor">
          <option value="Aron">Aron</option>
          <option value="Cande">Cande</option>
        </select>
      </div>
      <div class="campo-grupo">
        <label for="fecha">¿Cuándo?</label>
        <input type="date" id="fecha" name="fecha" required />
      </div>
      <div class="campo-grupo">
        <label for="detalle">¿Qué?</label>
        <textarea id="detalle" name="detalle" required></textarea>
      </div>
      <div class="campo-grupo">
        <label for="precio">¿Cuánto?</label>
        <input type="number" id="precio" name="precio" step="0.01" required />
      </div>
      <div class="campo-grupo">
        <label for="cuotas">¿En cuántas?</label>
        <input type="number" name="cuotas" id="cuotas" value="1" />
      </div>
      <div class="campo-grupo">
        <label for="tarjeta">¿Cuál?</label>
        <select name="tarjeta" id="tarjeta">
          <option value="Master BBVA">Master BBVA</option>
          <option value="Visa BBVA">Visa BBVA</option>
          <option value="Master NBSF">Master NBSF</option>
          <option value="Master BdS">Master BdS</option>
          <option value="MercadoCredito">MercadoCredito</option>
        </select>
      </div>
      <div class="campo-grupo">
        <label for="clave">Autenticación:</label>
        <input name="clave" id="clave" type="password" required />
      </div>

      <div class="botones-acciones">
        <button type="submit" class="boton-primario">Guardar</button>
      </div>
    </form>
  </div>

  <!-- Toast container -->
  <div id="toast" class="toast"></div>

<script>
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxYpzmxZJkTVRGF53K5WxNgMca0MwcPAONCGVz74uqYc1yLyyy2X8cd0yFU79roKbPH8g/exec';

  const dataForm = document.getElementById('dataForm');
  const submitButton = dataForm.querySelector('button[type="submit"]');

  dataForm.addEventListener('submit', function(e) {
    e.preventDefault();

    submitButton.disabled = true;
    submitButton.textContent = 'Enviando...';

    const formData = new FormData(dataForm);

    fetch(WEB_APP_URL, {
      method: 'POST',
      body: formData,
    })
    .then(response => response.json())
    .then(data => {
      console.log('Respuesta del servidor:', data);
      showToast(data.message);
      if (data.status === 'success') dataForm.reset();
    })
    .catch(error => {
      console.error('Error al enviar el formulario:', error);
      showToast('Hubo un error al guardar los datos.');
    })
    .finally(() => {
      submitButton.disabled = false;
      submitButton.textContent = 'Guardar';
    });
  });

  function showToast(msg) {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3500);
  }
</script>
</body>
</html>
